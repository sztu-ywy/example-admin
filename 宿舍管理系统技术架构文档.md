# 宿舍管理系统技术架构文档

## 1. 系统概述

### 1.1 项目背景
宿舍管理系统是一个现代化的学生宿舍综合管理平台，旨在提高宿舍管理效率，优化学生住宿体验，实现宿舍资源的智能化分配和精细化管理。

### 1.2 系统目标
- **提高管理效率**：自动化宿舍分配、维修工单处理、访客管理等流程
- **优化用户体验**：提供直观易用的管理界面和学生服务界面
- **数据驱动决策**：通过统计分析支持管理决策
- **系统可扩展性**：支持多校区、大规模用户的扩展需求

### 1.3 核心功能模块
- 楼栋管理：宿舍楼基础信息管理
- 房间管理：房间和床位的精细化管理
- 学生住宿：智能分配算法和住宿生命周期管理
- 维修工单：完整的报修流程和工单跟踪
- 访客管理：访客登记和审批流程
- 统计分析：多维度数据统计和可视化展示

## 2. 系统架构设计

### 2.1 整体架构
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   前端应用层     │    │   后端服务层     │    │   数据存储层     │
│                 │    │                 │    │                 │
│  Vue 3 + TS     │◄──►│   Go + Cosy     │◄──►│   MySQL 8.0     │
│  Ant Design     │    │   RESTful API   │    │   Redis 6.0     │
│  Admin Kit      │    │   JWT Auth      │    │                 │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

### 2.2 技术选型原则
- **前端现代化**：采用最新的前端技术栈，确保用户体验
- **后端高性能**：选择高性能的Go语言和成熟的框架
- **数据库稳定性**：使用企业级数据库确保数据安全
- **架构可扩展**：微服务友好的设计，支持水平扩展

## 3. 前端架构设计

### 3.1 技术栈
| 技术 | 版本 | 用途 |
|------|------|------|
| Vue.js | 3.4+ | 前端框架 |
| TypeScript | 5.0+ | 类型安全 |
| Vite | 6.0+ | 构建工具 |
| Ant Design Vue | 4.0+ | UI组件库 |
| Vue Router | 4.0+ | 路由管理 |
| Pinia | 2.0+ | 状态管理 |
| ECharts | 5.0+ | 数据可视化 |
| Admin Kit | 最新版 | 管理后台框架 |

### 3.2 项目结构
```
dormitory-web/
├── src/
│   ├── api/                 # API接口定义
│   │   ├── dormitory.ts     # 宿舍管理API
│   │   └── auth.ts          # 认证API
│   ├── components/          # 公共组件
│   ├── constants/           # 常量定义
│   │   └── acl.ts          # 权限常量
│   ├── layouts/            # 布局组件
│   ├── pages/              # 页面组件
│   │   └── dashboard/      # 仪表盘
│   ├── router/             # 路由配置
│   ├── store/              # 状态管理
│   ├── utils/              # 工具函数
│   └── views/              # 视图组件
│       └── dormitory/      # 宿舍管理视图
├── public/                 # 静态资源
├── package.json           # 项目配置
└── vite.config.ts         # 构建配置
```

### 3.3 核心特性
- **响应式设计**：支持桌面、平板、手机多端适配
- **组件化开发**：高度复用的组件设计
- **类型安全**：完整的TypeScript类型定义
- **权限控制**：基于角色的访问控制（RBAC）
- **国际化支持**：多语言切换能力
- **主题定制**：支持主题色彩定制

### 3.4 状态管理
```typescript
// 用户状态管理
interface UserState {
  token: string
  userInfo: UserInfo
  permissions: string[]
  isLoggedIn: boolean
}

// 应用状态管理
interface AppState {
  theme: 'light' | 'dark'
  locale: 'zh-CN' | 'en-US'
  collapsed: boolean
}
```

## 4. 后端架构设计

### 4.1 技术栈
| 技术 | 版本 | 用途 |
|------|------|------|
| Go | 1.21+ | 编程语言 |
| Cosy Framework | 最新版 | Web框架 |
| GORM | 1.25+ | ORM框架 |
| MySQL | 8.0+ | 主数据库 |
| Redis | 6.0+ | 缓存数据库 |
| JWT | - | 身份认证 |
| Swagger | - | API文档 |

### 4.2 项目结构
```
dormitory-api/
├── api/                    # API控制器
│   ├── admin/             # 管理员API
│   │   ├── building/      # 楼栋管理
│   │   ├── room/          # 房间管理
│   │   ├── student/       # 学生住宿
│   │   ├── repair/        # 维修工单
│   │   └── visit/         # 访客管理
│   └── student/           # 学生API
├── model/                 # 数据模型
├── internal/              # 内部包
│   ├── audit/            # 审计日志
│   ├── auth/             # 认证授权
│   └── runtime_settings/ # 运行时配置
├── router/               # 路由配置
├── config/               # 配置文件
├── docs/                 # API文档
├── go.mod               # Go模块
└── main.go              # 程序入口
```

### 4.3 核心特性
- **RESTful API**：标准的REST接口设计
- **JWT认证**：无状态的身份认证机制
- **权限控制**：细粒度的权限管理
- **数据验证**：完整的输入数据验证
- **错误处理**：统一的错误处理机制
- **日志记录**：完整的操作日志记录
- **缓存机制**：Redis缓存提升性能

### 4.4 API设计规范
```
GET    /admin/buildings          # 获取楼栋列表
POST   /admin/buildings          # 创建楼栋
PUT    /admin/buildings/:id      # 更新楼栋
DELETE /admin/buildings/:id      # 删除楼栋
GET    /admin/buildings/:id/statistics  # 楼栋统计
```

## 5. 数据库设计

### 5.1 数据库选型
- **主数据库**：MySQL 8.0
  - 事务支持完善
  - 性能稳定可靠
  - 生态系统成熟
- **缓存数据库**：Redis 6.0
  - 高性能内存存储
  - 丰富的数据结构
  - 持久化支持

### 5.2 数据库连接配置
```yaml
database:
  host: localhost
  port: 3306
  username: root
  password: password
  database: dormitory
  charset: utf8mb4
  max_open_conns: 100
  max_idle_conns: 10
  conn_max_lifetime: 3600

redis:
  host: localhost
  port: 6379
  password: ""
  database: 0
  pool_size: 10
```

## 6. 安全设计

### 6.1 认证授权
- **JWT Token**：无状态认证机制
- **角色权限**：基于RBAC的权限控制
- **密码加密**：bcrypt加密存储
- **会话管理**：Token过期和刷新机制

### 6.2 数据安全
- **SQL注入防护**：使用参数化查询
- **XSS防护**：输入输出过滤
- **CSRF防护**：Token验证机制
- **数据加密**：敏感数据加密存储

### 6.3 接口安全
- **请求限流**：防止恶意请求
- **参数验证**：严格的输入验证
- **错误处理**：避免信息泄露
- **日志审计**：完整的操作记录

## 7. 性能优化

### 7.1 前端优化
- **代码分割**：按需加载减少首屏时间
- **资源压缩**：Gzip压缩静态资源
- **缓存策略**：浏览器缓存和CDN加速
- **图片优化**：WebP格式和懒加载

### 7.2 后端优化
- **数据库优化**：索引优化和查询优化
- **缓存机制**：Redis缓存热点数据
- **连接池**：数据库连接池管理
- **异步处理**：耗时操作异步化

### 7.3 系统监控
- **性能监控**：响应时间和吞吐量监控
- **错误监控**：异常和错误统计
- **资源监控**：CPU、内存、磁盘监控
- **业务监控**：关键业务指标监控

## 8. 部署架构

### 8.1 开发环境
```
开发者本地 → Git仓库 → CI/CD流水线 → 测试环境
```

### 8.2 生产环境
```
负载均衡器 → 前端静态资源(CDN) → 后端服务集群 → 数据库集群
```

### 8.3 容器化部署
```dockerfile
# 前端Dockerfile
FROM node:18-alpine
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
RUN npm run build
FROM nginx:alpine
COPY --from=0 /app/dist /usr/share/nginx/html

# 后端Dockerfile
FROM golang:1.21-alpine AS builder
WORKDIR /app
COPY go.* ./
RUN go mod download
COPY . .
RUN go build -o main .
FROM alpine:latest
COPY --from=builder /app/main .
CMD ["./main"]
```

## 9. 扩展性设计

### 9.1 水平扩展
- **无状态设计**：服务无状态，支持多实例部署
- **数据库分片**：支持数据库水平分片
- **缓存集群**：Redis集群支持
- **负载均衡**：多种负载均衡策略

### 9.2 功能扩展
- **插件机制**：支持功能插件扩展
- **API版本控制**：向后兼容的API设计
- **配置中心**：动态配置管理
- **服务发现**：微服务架构支持

## 10. 运维监控

### 10.1 日志管理
- **结构化日志**：JSON格式日志输出
- **日志分级**：DEBUG、INFO、WARN、ERROR
- **日志聚合**：ELK Stack日志分析
- **日志轮转**：自动日志清理机制

### 10.2 监控告警
- **系统监控**：Prometheus + Grafana
- **应用监控**：APM性能监控
- **业务监控**：关键指标监控
- **告警通知**：多渠道告警通知

### 10.3 备份恢复
- **数据备份**：定期数据库备份
- **增量备份**：binlog增量备份
- **异地备份**：多地备份策略
- **恢复测试**：定期恢复演练
